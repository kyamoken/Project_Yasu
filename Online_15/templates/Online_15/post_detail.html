{% extends 'Online_15/base.html' %}
{% load custom_filters %}

{% block title %}{{ post.title }} - Online_15{% endblock %}

{% block content %}
<div class="content">
    <div class="post-box">
        <h2>{{ post.title|slice:":20" }}{% if post.title|length > 20 %}...{% endif %}</h2>
        {% if post.Image %}
            <img src="{{ post.Image.url }}" alt="Post Image" class="post-image">
        {% endif %}
        <p>{{ post.content|slice:":100" }}{% if post.content|length > 100 %}...{% endif %}</p>
        <div class="like-section">
            {% if user.is_authenticated %}
                <form method="post" action="{% url 'like_post' post.id %}">
                    {% csrf_token %}
                    <button type="submit" class="like-button" data-liked="{{ user|has_liked:post }}">
                        <i class="fa fa-heart{% if not user|has_liked:post %}-o{% endif %}"></i>
                    </button>
                </form>
            {% else %}
                <span class="like-button">
                    <i class="fa fa-heart-o"></i>
                </span>
            {% endif %}
            <span id="like-count">{{ post.likes }}</span>
        </div>
        {% if user.is_authenticated %}
            <form id="delete-form" action="{% url 'post_delete' post.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="delete-button">削除</button>
            </form>
        {% endif %}
    </div>
</div>
<style>
    .post-box {
        width: 800px; /* 固定幅 */
        height: 600px; /* 固定高さ */
        border: 1px solid #ccc; /* 枠線 */
        border-radius: 8px; /* 角を丸める */
        padding: 20px; /* 内側の余白 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 影を追加 */
        overflow: hidden; /* 内容がはみ出さないようにする */
        margin: 20px auto; /* 中央揃え */
    }

    .post-image {
        width: 100%; /* 幅を100%に設定 */
        height: 200px; /* 固定の高さを設定 */
        object-fit: cover; /* 画像を切り取ってカード全体にフィットさせる */
        border-radius: 8px; /* カードの角を丸める */
        margin-bottom: 10px; /* マージンを設定 */
    }
@media (max-width: 800px) {
    .post-box {
        width: 90%; /* 幅を90%に設定 */
        height: auto; /* 高さを自動調整 */
        margin: 10px auto; /* 中央揃え */
    }
}
</style>
{% if user.is_authenticated %}
<script>
    document.getElementById('delete-form').addEventListener('submit', function(event) {
        event.preventDefault();
        if (confirm('本当にこの投稿を削除してもよろしいですか？')) {
            fetch(this.action, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': this.querySelector('[name=csrfmiddlewaretoken]').value
                }
            }).then(response => {
                if (response.ok) {
                    alert('削除に成功しました');
                    window.location.href = "{% url 'home' %}";
                } else {
                    alert('削除に失敗しました');
                }
            });
        }
    });
</script>
{% endif %}
{% endblock %}